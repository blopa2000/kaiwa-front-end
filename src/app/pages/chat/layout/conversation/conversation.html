<div class="h-screen flex flex-col bg-gray-50">
  <!-- Si no hay chat ni room activa -->
  @if (!chat) {
    <app-empty-state />
  } @else {
    <!-- Header del chat -->
    <div class="p-4 border-b bg-white font-medium">
      Chat con {{ chat.username || chat.other_user?.username }}
    </div>

    <!-- Mensajes -->
    <div class="flex-1 p-4 overflow-y-auto flex flex-col-reverse">
      {{ messages().length }}
      @if (messages().length > 0) {
        @for (msg of messages(); track msg.id) {
          <div
            class="mb-2 p-2 rounded-lg max-w-xs"
            [ngStyle]="{
              'align-self': msg.sender_id === currentUserId ? 'flex-end' : 'flex-start',
              'background-color': msg.sender_id === currentUserId ? '#3B82F6' : '#E5E7EB',
              color: msg.sender_id === currentUserId ? '#FFFFFF' : '#1F2937',
            }"
          >
            {{ msg.content }}
            <div class="flex justify-end text-xs opacity-70 mt-1">
              @if (msg.sender_id === currentUserId) {
                @if (msg.read_at) {
                  ✔✔
                } @else {
                  ✔
                }
              }
            </div>
          </div>
        }
      } @else {
        <div class="text-center text-gray-400">No hay mensajes aún</div>
      }
    </div>

    <!-- Input de mensaje -->
    <div class="p-4 border-t bg-white">
      <input
        type="text"
        placeholder="Escribe un mensaje"
        class="w-full px-4 py-2 rounded-lg border"
        [(ngModel)]="messageText"
        (keydown.enter)="sendMessage()"
      />
    </div>
  }
</div>
